<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>
    <link href="~/Plugs/EasyUi/themes/default/easyui.css" rel="stylesheet" />
    <link href="~/Plugs/EasyUi/Css/icon.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-1.8.2.min.js"></script>
    <script src="~/Plugs/EasyUi/jquery.easyui.min.js"></script>
    <script src="~/Plugs/EasyUi/locale/easyui-lang-zh_CN.js"></script>
    <script src="~/Scripts/utils.js"></script>
    <style>
        .class-title {
            display: flex;
            justify-content: center;
            align-content: center;
        }

        #tabs {
            height: 100%;
        }

            #tabs .tabs-panels {
                height: 100%;
            }

            #tabs .panel-htop {
                height: 100%;
            }

            #tabs .panel-body-noborder {
                height: 100%;
            }

        .footer {
            display: flex;
            justify-content: center;
            align-content: center;
        }

        p {
            margin-bottom: 0px;
            margin-top: 0px;
        }
    </style>
</head>
<body class="easyui-layout">
    <h2>Basic Layout</h2>
    <p>The layout contains north,south,west,east and center regions.</p>
    <div style="margin:20px 0;"></div>
    <div data-options="region:'north'" style="height:74px" class="class-title">
        <h1>南京创客教育平台</h1>
    </div>
    <div data-options="region:'south',split:true" style="height:23px;">
        <div class="footer"><p>Copyright © 2017 临界风行. All rights reserved.</p></div>
    </div>
    <div data-options="region:'west',split:true" title="管理菜单" style="width:170px;">
        <div class="easyui-accordion" data-options="fit:true,border:false">
            <div title="人员管理" data-options="selected:true">
                <div style="margin: 5px">
                    <ul class="tree easyui-tree" data-options="animate:true,lines:true">
                        <li data-options="iconCls:'icon-group'">
                            <span>角色管理</span>
                            <ul>
                                <li data-options="iconCls:'icon-add'">
                                    <span>添加角色</span>
                                </li>
                                <li data-options="iconCls:'icon-remove'">
                                    <span>添加权限</span>
                                </li>
                                <li data-options="iconCls:'icon-save'">
                                    <span>添加角色权限</span>
                                </li>
                            </ul>
                        </li>
                        <li data-options="state:'closed',iconCls:'icon-joystick'">
                            <span>用户管理</span>
                            <ul>
                                <li data-options="iconCls:'icon-joystick_add'">
                                    <span>用户查询</span>
                                </li>
                                <li data-options="iconCls:'icon-joystick_add'">
                                    <span>用户角色</span>
                                </li>
                                <li data-options="iconCls:'icon-joystick_add'">
                                    <span>用户权限</span>
                                </li>
                                <li data-options="iconCls:'icon-joystick_add'">
                                    <span>用户修改</span>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
            <div title="大赛管理" data-options="selected:true">
                <div style="margin: 5px">
                    <ul class="tree easyui-tree" data-options="animate:true,lines:true">
                        <li data-options="iconCls:'icon-group'">
                            <span>大赛总览</span>
                            <ul>
                                <li data-options="iconCls:'icon-add'">
                                    <span>大赛查询</span>
                                </li>
                                <li data-options="iconCls:'icon-remove'">
                                    <span>大赛修改</span>
                                </li>
                                <li data-options="iconCls:'icon-save'">
                                    <span>大赛回顾</span>
                                </li>
                            </ul>
                        </li>
                        <li data-options="state:'closed',iconCls:'icon-joystick'">
                            <span>大赛创建</span>
                            <ul>
                                <li data-options="iconCls:'icon-joystick_add'">
                                    <span>test4</span>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div data-options="region:'center'">
        <div id="tabs" class="easyui-tabs" data-options="tools:'#tab-tools'">
            <div title="主页" data-options="iconCls:'icon-house'" style="padding: 10px; height: 100%;">
                @RenderBody()
                <div id="mm" class="easyui-menu" style="width: 150px;">
                    <div id="refresh" data-options="iconCls:'icon-mini-refresh'">刷新</div>
                    <div class="menu-sep"></div>
                    <div id="close">关闭</div>
                    <div id="closeall">全部关闭</div>
                    <div id="closeother">除此之外全部关闭</div>
                    <div class="menu-sep"></div>
                    <div id="closeright">当前页右侧全部关闭</div>
                    <div id="closeleft">当前页左侧全部关闭</div>
                    <div class="menu-sep"></div>
                    <div id="exit">退出</div>
                </div>
            </div>
        </div>
        <div id="tab-tools">
            <a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-add'" onclick="addTab()"></a>
            <a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-remove'" onclick="removeTab()"></a>
        </div>
    </div>
</body>
@*<body>
        <div class="container">
            <div class="search">
                <input type="text"  id="searchName"/><!--否则有换行符
                --><button onclick="search()"></button>
            </div>
            <div class="content">
                <div class="content-info">
                    @RenderBody()
                 </div><!--否则有换行符
                     --><div class="nav">
                        <div id="menuTree" class="menuTree"></div>
                    </div>
                </div>
        </div>
        <script src="~/Scripts/TreeView/treeView.js"></script>
        @Scripts.Render("~/bundles/jquery")
        @RenderSection("scripts", required: false)
    </body>*@
</html>
<script>
    var onlyOpenTitle = "主页";//不允许关闭的标签的标题
    $(function () {
        tabClose();
        tabCloseEven();
    })
    function tabClose() {
        /*双击关闭TAB选项卡*/
        $(".tabs-inner").dblclick(function () {
            var subtitle = $(this).children(".tabs-closable").text();
            $('#tabs').tabs('close', subtitle);
        })
        /*为选项卡绑定右键*/
        $(".tabs-inner").bind('contextmenu', function (e) {
            $('#mm').menu('show', {
                left: e.pageX,
                top: e.pageY
            });
            var subtitle = $(this).children(".tabs-closable").text();
            $('#mm').data("currtab", subtitle);
            $('#tabs').tabs('select', subtitle);
            return false;
        });
    }
    //绑定右键菜单事件
    function tabCloseEven() {
        $('#mm').menu({
            onClick: function (item) {
                closeTab(item.id);
            }
        });
        return false;
    }

    //创建/移除tab
    var index = 0;
    function addTab(subtitle, url, icon) {
        index++;
        if (!$('#tabs').tabs('exists', subtitle)) {
            $('#tabs').tabs('add', {
                title: 'Tab' + index,
                content: createFrame('http://www.baidu.com/'),
                closable: true,
                icon: '',
            });

        } else {
            $('#tabs').tabs('select', subtitle);
            $('#mm-tabupdate').click();
        }
        tabClose();
    }
    function removeTab() {
        var tab = $('#tabs').tabs('getSelected');
        if (tab) {
            var index = $('#tabs').tabs('getTabIndex', tab);
            $('#tabs').tabs('close', index);
        }
    }
    //创建Frame
    function createFrame(url) {
        var s = '<iframe scrolling="auto" frameborder="0"  src="' + url + '" style="width:100%;height:100%;"></iframe>';
        return s;
    }

    //关闭tab
    function closeTab(action) {
        var alltabs = $('#tabs').tabs('tabs');
        var currentTab = $('#tabs').tabs('getSelected');
        var allTabtitle = [];
        $.each(alltabs, function (i, n) {
            allTabtitle.push($(n).panel('options').title);
        })
        switch (action) {
            case "refresh":
                var iframe = $(currentTab.panel('options').content);
                var src = iframe.attr('src');
                $('#tabs').tabs('update', {
                    tab: currentTab,
                    options: {
                        content: createFrame(src)
                    }
                })
                break;
            case "close":
                var currtab_title = currentTab.panel('options').title;
                $('#tabs').tabs('close', currtab_title);
                break;
            case "closeall":
                $.each(allTabtitle, function (i, n) {
                    if (n != onlyOpenTitle) {
                        $('#tabs').tabs('close', n);
                    }
                });
                break;
            case "closeother":
                var currtab_title = currentTab.panel('options').title;
                $.each(allTabtitle, function (i, n) {
                    if (n != currtab_title && n != onlyOpenTitle) {
                        $('#tabs').tabs('close', n);
                    }
                });
                break;
            case "closeright":
                var tabIndex = $('#tabs').tabs('getTabIndex', currentTab);

                if (tabIndex == alltabs.length - 1) {
                    alert('亲，后边没有啦!');
                    return false;
                }
                $.each(allTabtitle, function (i, n) {
                    if (i > tabIndex) {
                        if (n != onlyOpenTitle) {
                            $('#tabs').tabs('close', n);
                        }
                    }
                });
                break;
            case "closeleft":
                var tabIndex = $('#tabs').tabs('getTabIndex', currentTab);
                if (tabIndex == 1) {
                    alert('亲，前边那个上头有人，咱惹不起!');
                    return false;
                }
                $.each(allTabtitle, function (i, n) {
                    if (i < tabIndex) {
                        if (n != onlyOpenTitle) {
                            $('#tabs').tabs('close', n);
                        }
                    }
                });
                break;
            case "exit":
                $('#closeMenu').menu('hide');
                break;
        }
    }
</script>